#### 路由器的工作原理

##### 一，回顾交换机的工作原理

- 交换机里维护了一张MAC地址表，主要记录了MAC地址与接口的对应关系
- 在初始状态下，MAC地址表是空的，当收到某接口(f0/1)的数据时，首先查看数据帧中的源MAC地址，对照自己的MAC地址表，如果不在表中，将发送方的MAC地址学习并记录到自己的MAC地址表中，并附上对应的接口(f0/1)，再查看目的MAC地址，如果目的MAC地址也不在MAC表中，将进行从接收接口(f0/1)外的其它所有接口转发出去（广播方式），此时，目的主机将接收到，其他主机也会接收到，但由于目标MAC不是自己，其它主机会直接丢弃。目的主机收到后进行回应，回应的过程中数据同样会交由交换机进行转发，目的主机这时就会变成回应的发送主机，当交换机收到来自目的主机的回应报文时(f0/10)，会同样查看发送方的MAC地址，进行学习并记录，并附带对应接口(f0/10)，再去查看目的MAC，由于之前已有记录，所以直接从记录的接口(f0/1)进行转发（单播）。
- 总结：交换学习源MAC，广播数据帧，接收方回应，回应使用单播直接转发。

##### 二，回顾路由器相关知识

- 路由器属于三层（网络层）设备
- 网络层所封装的是IP头部
- 网络层功能
  - 进行逻辑地址（IP地址）寻址，实现不同网络（网络地址不等或者说内网和外网分割）之间的路径选择
  - 去查找目的是否可到达，如果可以则选择最优路径，如果无法到达，则直接返回给发送方一个消息
- 网络层所传输的PDU(传输数据单元)是 数据包(IP数据包)

##### 三，网络层IP数据包的格式

- IPv4
  - 版本：标识当前使用的IP版本
  - 首部长度：由于IP数据报文的首部有一个可选项，造成首部长度可变，所以需要定义
  - 区分服务(服务质量/优先级和服务类型)：主要是在IP层做Qos
  - 总长度：主要用来标识整个数据包的长度
  - 标识，标志，片位移：上层来的数据到IP层会被分片，这几个字段用来对数据包进行标识，使数据到达目的端重组时不会乱序
  - 生存时间(TTL值)：数据包在路由器的转发消耗时间，如果小于1秒，TTL就会减1
  - 协议：标识上层数据使用的哪种协议(TCP是6/UDP是17)
  - 首部校验：校验数据报文的首部
  - 源地址：发送方的IP地址
  - 目的地址：接收方的IP地址
- IPv6
- ......

##### 四，路由器的工作原理

1，路由

- 从源主机到目标主机的转发过程（跨网络访问）
- 包含两个内容：
  - 确定最佳路径（手动指定，根据动态路由协商方式）
  - 通过网络传输信息

2，路由器的原理

![image-20220903222132778](https://raw.githubusercontent.com/Bssn520/Images/master/Test/202212201810844.png)

- 路由表
  - 直连路由：当路由器的接口配置好对应的IP地址并开启接口后自动生成
  - 非直连路由：需要手动配置静态路由或者使用动态路由协议学习到

3，静态路由

- 由管理员手动配置，不灵活
- 特殊的静态路由：默认路由，当在路由器中找不到目标网络的路由条目时，再去查看默认路由
  - 使用场景：一般用于末节(末梢)网络(网络的最末端)（路由器的一端只连接了一个网络）

4，动态路由

- 通过某种动态路由协议自动的去建立自己的路由表
- 常见的动态路由协议：RIP    OSPF    IS-IS    BGP    IGRP    EIGRP

##### 五，路由器转发数据包的封装过程

![image-20220904213612316](https://raw.githubusercontent.com/Bssn520/Images/master/Test/202212201810845.png)

##### 六，静态路由配置


